Building Laravel and Vue.js Web Apps (see https://www.lynda.com/Laravel-tutorials/Building-Laravel-Vue-js-Web-Apps):

Description:
Vue.js ships with Laravel, the hugely popular PHP web framework. But using this front-end framework along with Laravel to build full-stack web applications comes with its own set of challenges. In this project-based course, instructor Michael Sullivan steps through how to work with Vue.js and Laravel to create elegant, real-world apps. As he shows how to build a content management tool for a restaurant menu, Michael demonstrates how to scaffold an authentication system, build an embedded SPA with Vue Router, manage state complexity using Vuex, and more.

Topics include:
-Configuring a virtual machine
-Using webpack and Laravel Mix
-Managing file uploads
-Protecting routes and models with policies
-Building an API with Laravel Passport
-Building an embedded SPA with Vue Router
-Protecting admin pages with gates
-Displaying model validation errors
-Managing state complexity using Vuex

Building Laravel and Vue.js Web Apps: Module 0: Introduction: Laravel and Vue.js--Achieving full-stack elegance:
-Vue.js is now the default javascript library that comes wiith Laravel

Building Laravel and Vue.js Web Apps: Module 0: Introduction: What you should know:
-This course is not an introduction to PHP so you should be comfortable with that
-MVC architecture
-This course is not an introduction to Vue.js so you should have experience with Vue.js already (see instructor`s course "Learning Vue.js" to get up to speed)

Software and Tooling (optional):
-Node.js
-Visual Studio Code
-Vue.js devtools extension (Chrome or Firefox)
-Vagrant and VirtualBox (or other virtualization provider)
-Git

Building Laravel and Vue.js Web Apps: Module 0: Introduction: Demo Project Overview:
-Nadia`s garden website

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Installing Homestead:
-https://laravel.com
-Homestead is a virtual machine that comes pre-packaged with everything you need to build websites with laravel and vue.js
-Homestead is a Vagrant box
-Vagrant alone can`t handle everything--we also need a virtualization provider such as VirtualBox, VMWare or AWS to actually run the virtual machine
-Also the instructor will be using PowerShell and he suggests running the shell as administrator as well as your IDE 
-This is the command to add the homestead box to Vagrant (see https://laravel.com/docs/6.x/homestead) but please note that you may need to choose the VM provider:

    $ vagrant box add laravel/homestead
    ==> box: Loading metadata for box 'laravel/homestead'
        box: URL: https://vagrantcloud.com/laravel/homestead
    ==> box: Adding box 'laravel/homestead' (v9.2.2-alpha1) for provider: virtualbox
        box: Downloading: https://vagrantcloud.com/laravel/boxes/homestead/versions/9.2.2-alpha1/providers/virtualbox.box
        box: Download redirected to host: vagrantcloud-files-production.s3.amazonaws.com
        box:
        box: Calculating and comparing box checksum...
    ==> box: Successfully added box 'laravel/homestead' (v9.2.2-alpha1) for 'virtualbox'!

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Configuring and booting the virtual machine:
-We need to clone the repository on github because it has scripts we need to configure and boot the VM

    $ git clone https://github.com/laravel/homestead.git ~/Homestead

-Now let us checkout the latest stable version which you can copy from the github page:

    https://github.com/laravel/homestead/releases

v10.1.0

    $ cd ~/Homestead
    $ git checkout v10.1.0

-Now let us configure homstead where you can see these files:

init.bat
init.sh

    $ sh init.sh
    Homestead initialized!

Now you will see:

Homestead.yaml

-Now let us view the file using

    $ code Homestead.yaml

-Open a terminal in Visual Studio Code using:

    <CTRL> - `

-Make a directory for nadiasgarden restaurant

PS C:\Users\msull> mkdir nadias

-We are doing this now so that we can tell vagrant to sync the files in this directory with a directory inside the VM
-This lets us edit the code inside the host machine and run that code inside the guest VM
-See Homestead.yaml and edit:

folders:
    - map: ~/code
      to: /home/vagrant/code

To:

folders:
    - map: ~/nadias
      to: /home/vagrant/code

-Let us edit the domain from:

sites:
    - map: homestead.test
      to: /home/vagrant/code/public

To:

sites:
    - map: dev.nadias
      to: /home/vagrant/nadias/public

-Change database name from:

databases:
    - homestead

To:

databases:
    - nadias

-Now we need to make sure that the domain name we chose is mapped to the local ip address for the box:

ip: "192.168.10.10"

We do this by editing our hosts file (on linux it is at /etc/hosts):

C:\Windows\System32\drivers\etc\hosts

Now add:

192.168.10.10 dev.nadias

-Back in the yaml file we will need to be able to connect to the machine using ssh

keys:
    - ~/.ssh/id_rsa

-If you comment out the above section vagrant will create and manage the keys for you:

#keys:
#    - ~/.ssh/id_rsa

-Now if we cd to ~/Homestead we are ready to boot the machine with:

    $ vagrant up
    ...
    $ vagrant ssh
    Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-72-generic x86_64)
    ....

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Scaffolding an authentication system:
-Now inside the vm we can just do:

    vagrant@homestead:~$ laravel new nadias --force
    Crafting application...
    Loading composer repositories with package information
    Installing dependencies (including require-dev) from lock file
        1/76:       https://codeload.github.com/sebastianbergmann/code-unit-reverse-lookup/legacy.zip/4419fcdb5eabb9caa61a27c7a1db532a6b55dd18
    ...
    
-Now we should already be able to navigate to the dev.nadias and see the default laravel website

    http://dev.nadias/

-Now in Visual Studio Code choose File -> "Add Folder to Workspace" and choose "nadias"
-Most of the code is under app but let`s take a look under routes where we will see web.php

<?php

Route::get('/', function () {
    return view('welcome');
});

-This opens welcome.blade.ph
-Now to add a user authentication framework, inside vagrant just cd to ~/nadias and type "artisan make:auth"

-> NOTE: In laravel 6 you need INSTEAD to use these commands:

    $ composer require laravel/ui --dev
    ...
    $ php artisan ui vue --auth
    ...
    $ npm install
    ....
    $ npm run dev
    ...

-Now that we have installed auth we can now see this has been aded to web.php:

Auth::routes();

Route::get('/home', 'HomeController@index')->name('home');


-We also have new views under:

~resources\views\auth

-Now refresh the homepage at http://dev.nadias/ and click "Register" in the top RHS, and fill out the form:

Roger
rmoore@example.com
nadias123

And click Register

-We will get an error because we still don`t have a users table in our database, and it is still using Homestead for the database name so we want instead for it to use nadias so let`s fix that

Illuminate\Database\QueryException
SQLSTATE[42S02]: Base table or view not found: 1146 Table 'nadias.users' doesn`t exist (SQL: select count(*) as aggregate from `users` where `email` = roger@example.com)
http://dev.nadias/register

-Under config in database.php it us checking DB_DATABASE to find the database and then using forge if it can`t find the database

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DATABASE_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'forge'),
            'username' => env('DB_USERNAME', 'forge'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

-The above is using the environment variable DB_DATABASE to get the database name and using forge if it can`t find the environment variable
-Let us change it in our .env file

APP_NAME="Nadia's Garden Restaurant"
APP_URL=http://dev.nadias
DB_DATABASE=nadias

-Now add admin column to users table in the migration:

    public function up()
    {
        Schema::create('users', function (Blueprint $table) {
            $table->bigIncrements('id');
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->boolean('is_admin')->default(false);
            $table->rememberToken();
            $table->timestamps();
        });
    }

-Now run migration using:

    vagrant@homestead:~/nadias$ ./artisan migrate

-Now go back and try to create a user again
-We should be able to login and logout at this point
-In the next video we will talk about email verification and forgotten passwords

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Enabling forgotten password and email verification:
-If I pick "Forgot Your Password?" and hit submit I`m going to get an error because the default SMTP user doesn`t have a password:

Swift_TransportException
Expected response code 250 but got code "530", with message "530 5.7.1 Authentication required "

-In the .env file if we change MAIL_DRIVER from smtp to log we will log emails instead of trying to send them:

MAIL_DRIVER=smtp

To:

MAIL_DRIVER=log

-The logs are located in ~\storage\logs

-Users will be required to click an email verification link upon registration
-In user.php we need to add the MustVerifyEmail interface:

class User extends Authenticatable implements MustVerifyEmail

-The above will trigger the verification logic on registration and email a link to the user
-Now in our web.php we need to add some routes for sending and verifying registration links
-We do this by passing an options array to routes:

Auth::routes(['verify' => true]);

-If we want to restrict access to the website to only allow users that have verified their emails, added verified at the end here:

Route::get('/home', 'HomeController@index')->name('home')->middleware('verified');

-If you go to mailtrap.io then you can sign up for an account that can hold up to 50 emails for free without needing a credit card
-At mailtrap.io go to the demo inbox to find the username and password you can add to our laravel .env file:

Username:	d27f58e52ab04e
Password:	13fba7772cbe57

MAIL_HOST=smtp.mailtrap.io
MAIL_USERNAME=d27f58e52ab04e
MAIL_PASSWORD=13fba7772cbe57

-Also change mail driver back to smtp:

MAIL_DRIVER=smtp

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Using webpack with Laravel Mix:
-See ~\BuildingLaravelVueJsWebApps\DemosLaravelVueJS\Ch1\01_05\begin
-To compile and bundle such as javascript files, and CSS and SASS files, in our ~\resources\views\layouts\app.blade.php, we see these assets:

    <!-- Scripts -->
    <script src="{{ asset('js/app.js') }}" defer></script>

    <!-- Styles -->
    <link href="{{ asset('css/app.css') }}" rel="stylesheet">

-That asset helper returns an absolute URL with HTTP or HTTPS
-Those files are in ~\public\js and ~\public\css
-Those files are recreated whenever the resources files change, such as:

    ~\resources\js\app.js
    ~\resources\sass\app.css

-Let`s look at this file:    
    ~\resources\js\app.js    

/**
 * First we will load all of this project`s JavaScript dependencies which
 * includes Vue and other libraries. It is a great starting point when
 * building robust, powerful web applications using Vue and Laravel.
 */

require('./bootstrap');

window.Vue = require('vue');

/**
 * The following block of code may be used to automatically register your
 * Vue components. It will recursively scan this directory for the Vue
 * components and automatically register them with their "basename".
 *
 * Eg. ./components/ExampleComponent.vue -> <example-component></example-component>
 */

// const files = require.context('./', true, /\.vue$/i)
// files.keys().map(key => Vue.component(key.split('/').pop().split('.')[0], files(key).default))

Vue.component('example-component', require('./components/ExampleComponent.vue').default);

/**
 * Next, we will create a fresh Vue application instance and attach it to
 * the page. Then, you may begin adding components to this application
 * or customize the JavaScript scaffolding to fit your unique needs.
 */

const app = new Vue({
    el: '#app',
});

-Notice that this loads bootstrap.js which in turn loads a number of utilities like loaddash, jquery and axios
-This line registers view to the global scope:

window.Vue = require('vue');window.Vue = require('vue');

-It also registers a global component:

Vue.component('example-component', require('./components/ExampleComponent.vue').default);

-This mounts our root Vue instances to a div with the id app which is in the layout file we just looked at:

const app = new Vue({
    el: '#app',
});

-Vue may be complicated but configuring it with laravel is simple
-Notice in webpack.mix.js there is a source (resources) and target (public) directory:

mix.js('resources/js/app.js', 'public/js')
   .sass('resources/sass/app.scss', 'public/css');

-Let us try putting ExampleComponent.vue on a page and then changing it
-Let us first install the Vetur extension in Visual Studio Code
-In home.blade.php let us add it:

@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Dashboard</div>

                <div class="card-body">
                    @if (session('status'))
                        <div class="alert alert-success" role="alert">
                            {{ session('status') }}
                        </div>
                    @endif

                    You are logged in!
                </div>
                <example-component></example-component>
            </div>
        </div>
    </div>
</div>
@endsection

-Now in ExampleComponent.vue let us add the text "edited" and do a refresh:

<template>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">Example Component</div>

                    <div class="card-body">
                        I`m an example component - edited.
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    export default {
        mounted() {
            console.log('Component mounted.')
        }
    }
</script>

-If we do a refresh we don`t see the "edited" text added because webpack is not even running yet
-The browser doesn`t read .vue files on its own
-Before we can get webpack running we need to install some front-end dependencies.  We usually want npm to do that on our host machine.
-Now on the host do an install (open a terminal in Visual Studio Code by typing <CTRL>-<SHIFT>-`):

PS C:\Workspace\Resources\Courses\Lynda\BuildingLaravelVueJsWebApps\nadias> npm install
npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.11 (node_modules\fsevents):
npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.11: wanted {"os":"darwin","arch":"any"} (current: {"os":"win32","arch":"x64"})

added 1040 packages from 491 contributors and audited 17228 packages in 61.637s

29 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

PS C:\Workspace\Resources\Courses\Lynda\BuildingLaravelVueJsWebApps\nadias> npm run watch-poll

-Now go back to web page and type <CTRL>-F5 to do a hard refresh
-So you should now see on the home page:

I`m an example component - edited.

Building Laravel and Vue.js Web Apps: Module 1: Installation and Configuration: Cache busting and Browsersync:
-See ~\BuildingLaravelVueJsWebApps\DemosLaravelVueJS\Ch1\01_06\begin\nadias
-Often times when you reload a webpage it will retrieve the value in the cache.  One way to prevent this issue is to add a query string with a unique hash to the file name.
-We can accomplish this by adding a call to the version in our webpack.mix.js file 

mix.js('resources/js/app.js', 'public/js')
    .sass('resources/sass/app.scss', 'public/css')
    .version();

-In our app.blade.php layout file remember that asset just creates an absolute URL so we will have to change asset to mix:

    <!-- Scripts -->
    <script src="{{ asset('js/app.js') }}" defer></script>

    <!-- Styles -->
    <link href="{{ asset('css/app.css') }}" rel="stylesheet">

To:

    <!-- Scripts -->
    <script src="{{ mix('js/app.js') }}" defer></script>

    <!-- Styles -->
    <link href="{{ mix('css/app.css') }}" rel="stylesheet">    

-Now stop the running npm watch process with CTRL-C:

    ch job (Y/N)? y
    PS C:\Users\msull\nadias

And then restart it:

    PS C:\Users\msull\nadias> npm run watch

-Now you will see the changes immediately if you do a refresh and you will also see the hash if you view the source:

    <!-- Scripts -->
    <script src="/js/app.js?id=61fcbbd9446cf7c8619c" defer></script>

-Let us test a change a change to our sass file now--open ~\resources\js\sass\app.scss and change it to yellow:

.navbar-laravel {
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

To:

.navbar-laravel {
    background-color: $yellow;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

-> $yellow is defined in the variables file _variables.scss

-Cache busting is important during production but we don`t really need it in development if we can perform a full page refresh whenever a page changes
-We can do that:

webpack.mix.js:

mix.js('resources/js/app.js', 'public/js')
    .sass('resources/sass/app.scss', 'public/css');

if (mix.inProduction()) {
    mix.version();
}

mix.browserSync('dev.nadias');

-Now when I stop and restart "npm run watch" you will see it will load the site on localhost:

http://localhost:3000

-Now we have VS Code auto-saving, then webpack.mix.js auto-compiling, and then browser auto-refreshing
-Webpack also has a feature called hot module replacement that that can inject updated modules without a full page refresh; see package.json:

"hot": "cross-env NODE_ENV=development node_modules/webpack-dev-server/bin/webpack-dev-server.js --inline --hot --config=node_modules/laravel-mix/setup/webpack.config.js",

-Thus you can disable browser sync and type "npm run hot" instead; it is a great feature but the instructor says he has found it can be a bit harder to get working especially where there are more moving parts like in this Laravel project where mix is running on top of webpack
-The other great thing about browser sync is that it will refresh after php changes as well
-So now go to either http://dev.nadias or http://localhost:3000 and then open welcome.blade.php and change:

<title>Laravel</title>

To:

<title>Nadia`s Garden Restaurant</title>

-Then if you go back to the main page you will see that it has already refreshed

Building Laravel and Vue.js Web Apps: Module 2: MV* Architectures: Integrating a Layout:
-Let us change the web.php routes file:

Route::get('/', function () {
    return view('welcome');
});

To:

Route::get('/', function () {
    return view('home');
});

-Now add this folder to the Visual Studio Code workspace:

C:\Workspace\Resources\Courses\Lynda\BuildingLaravelVueJsWebApps\DemosLaravelVueJS\Ch2\02_01\begin\nadias_html

-Let us open C:\Workspace\Resources\Courses\Lynda\BuildingLaravelVueJsWebApps\DemosLaravelVueJS\Ch2\02_01\begin\nadias_html\index.html and copy the title:

Nadia`s Garden Restaurant

And open app.blade.php and replace:

<title>{{ config('app.name', 'Laravel') }}</title>    

with:

<title>{{ config('app.name', "Nadia`s Garden Restaurant") }}@yield('title')</title>    

Let us also remove these font elements from the Laravel layout:

    <!-- Fonts -->
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">

And add our fav icon:

<link rel="icon" href="/images/favicon.ico">

Now in our index.html let us copy the URL for this font:

http://fonts.googleapis.com/css?family=Old+Standard+TT%3A400%2C400italic%2C700%7CMontserrat%3A400%2C700&#038;ver=1.0.0

To:

@import url('http://fonts.googleapis.com/css?family=Old+Standard+TT%3A400%2C400italic%2C700%7CMontserrat%3A400%2C700&#038;ver=1.0.0');

And remove:

// Bootstrap
@import '~bootstrap/scss/bootstrap';

.navbar-laravel {
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

-The instructor is going to leave this yield because it is what is going to allow our content pages to extend this layout:

@yield('content')

-Now let us grab those authentication links and integrate them into the existing nadia`s nav bar
...

-Now if we check the browser we see our branded homepage we we can start adding some dynamic behaviour to it over the next few videos

Building Laravel and Vue.js Web Apps: Module 2: MV* Architectures: Creating a model and seeding the database:
-Now let us change the app so that the category names and image file names are pulled from the database
-Go to the nadias shell inside Visual Studio code

$ artisan make:model Category -mr

Full command:

roger@MSI MINGW64 /c/Workspace/Resources/Courses/Lynda/BuildingLaravelVueJsWebApps/Homestead ((c6a5fdf...))
$ vagrant ssh
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-74-generic x86_64)


1 package can be updated.
0 updates are security updates.


Last login: Thu Jan 23 17:53:45 2020 from 10.0.2.2
vagrant@homestead:~$ cd nadias
vagrant@homestead:~/nadias$ ./artisan make:model Category -mr
Model created successfully.
Created Migration: 2020_01_23_175454_create_categories_table

-Now in the app folder we should have a Category.php file and a CategoryController.php
-Also there will be a new migrations file in database/migrations

-Let us add 'name' and 'image' columns to Category
-Also let us add unsignedTinyInteger('display_order')

<?php

use Illuminate\Support\Facades\Schema;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Migrations\Migration;

class CreateCategoriesTable extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('categories', function (Blueprint $table) {
            $table->increments('id');
            $table->string('name');
            $table->string('image');
            $table->unsignedTinyInteger('display_order');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('categories');
    }
}

-Now run artisan migrate and seeder:

vagrant@homestead:~/nadias$ ./artisan migrate
...

vagrant@homestead:~/nadias$ ./artisan make:seeder CategoriesTableSeeder

-Which will create:

<?php

use Illuminate\Database\Seeder;

class CategoriesTableSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        DB::table('categories')->insert([
            [
                'name' => 'Starters',
                'image' => 'mushrooms.jpg',
                'display_order' => 1
            ],
            [
                'name' => 'Salads',
                'image' => 'salad.jpg',
                'display_order' => 2
            ],
            [
                'name' => 'Entrees',
                'image' => 'burger.jpg',
                'display_order' => 3
            ],
        ]);
    }
}

-We will insert the desert category using our admin tool later
-Now run the seeder:

vagrant@homestead:~/nadias$ ./artisan db:seed

-BTW you might need to run this first for it to resolve the Categories table if you get this error:

   Illuminate\Contracts\Container\BindingResolutionException  : Target class [CategoriesTableSeeder] does not exist.

vagrant@homestead:~/nadias$ composer dump-autoload

-Now we can verify everything worked in MySQL:

vagrant@homestead:~/nadias$ mysql nadias

mysql> select * from categories;
+----+----------+---------------+---------------+------------+------------+
| id | name     | image         | display_order | created_at | updated_at |
+----+----------+---------------+---------------+------------+------------+
|  1 | Starters | mushrooms.jpg |             1 | NULL       | NULL       |
|  2 | Salads   | salad.jpg     |             2 | NULL       | NULL       |
|  3 | Entrees  | burger.jpg    |             3 | NULL       | NULL       |
+----+----------+---------------+---------------+------------+------------+
3 rows in set (0.00 sec)

mysql>

Building Laravel and Vue.js Web Apps: Module 2: MV* Architectures: Building views with Blade templates:
-Now let us remove the should route here from web.php and we will want to use the home controller method




    













